---
import reactUuid from 'react-uuid';
import { IconHome } from '@tabler/icons';

import Base from '../components/Base.astro';
import { BlogCard } from '../components/BlogCard';
import { isPostRecent } from '../utils/isPostRecent';

let posts: Record<string, any> = [];

try {
  posts = (await Astro.glob('./blog/*.{md, mdx}'))
    .filter((post) => !post.frontmatter.draft)
    .sort(
      (a, b) =>
        new Date(b.frontmatter.pubDate).valueOf() -
        new Date(a.frontmatter.pubDate).valueOf()
    );
} catch (err) {
  posts = [];
}
---

<Base>
  <div class="lg:mx-auto xl:max-w-screen-xl">
    <div class="flex justify-center lg:justify-start">
      <a
        href="/"
        role="button"
        class="inline-flex items-center gap-x-2 rounded-md bg-gray-600 px-3 py-2 text-gray-100 hover:text-gray-400 dark:bg-gray-700 dark:text-gray-200 dark:hover:text-gray-50"
      >
        <span class="mb-0.5">
          <IconHome client:only="react" />
        </span>
        <span class="text-sm font-medium">Início</span>
      </a>
    </div>

    <div
      class="flex flex-col items-center justify-center gap-8 py-10 md:flex-row md:flex-wrap md:justify-around md:gap-8 lg:justify-between"
    >
      {
        posts.length === 0 && (
          <div class="mx-auto rounded-lg border border-gray-300 p-4 text-zinc-800 transition-colors dark:border-slate-600 dark:text-gray-200 dark:hover:bg-gray-200 dark:hover:text-zinc-700 ">
            Não há postagens publicadas
          </div>
        )
      }

      <>
        {
          posts.length > 0 &&
            posts.map((post) => (
              <BlogCard
                key={reactUuid()}
                href={post.url}
                title={post.frontmatter.title}
                description={post.frontmatter.description}
                createdAt={post.frontmatter.pubDate}
                tags={post.frontmatter.tags}
                isNew={isPostRecent(post.frontmatter.pubDate)}
                client:load
              />
            ))
        }
      </>
    </div>
  </div>
</Base>
